# ============================================================
# COCKPIT - ENVIRONMENT VARIABLES
# ============================================================
# üîí SECURITY NOTICE - READ THIS FIRST!
# ============================================================
#
# ‚ö†Ô∏è  CRITICAL SECURITY REQUIREMENTS:
#
# 1. NEVER commit .env or .env.local files to Git
# 2. NEVER use the example values below in production
# 3. ALWAYS rotate secrets when:
#    - A team member leaves
#    - Every 90 days (recommended)
#    - If any breach is suspected
# 4. Use a secret manager in production (AWS Secrets Manager, HashiCorp Vault)
# 5. Different secrets for dev/staging/production environments
#
# Setup Instructions:
# 1. Copy this file: cp .env.example .env.local
# 2. Generate all secrets (see commands below)
# 3. Fill in your specific values in .env.local
# 4. Verify .env.local is in .gitignore
#
# Fixed: V-010, V-011 - All production secrets must be rotated
# ============================================================

# ============================================================
# DATABASE (Required)
# ============================================================
# üîê Generate: Use your database provider's console (Neon, Supabase, etc.)
#
# Fixed: V-010 (CVSS 9.8) - NEVER commit actual DATABASE_URL to Git
# Impact: Full database compromise if leaked
#
# Development: Use local PostgreSQL or cloud development database
# Production: Use managed PostgreSQL with SSL (e.g., Neon, RDS, Cloud SQL)
#
# PostgreSQL connection string (pooled)
DATABASE_URL=postgresql://user:password@localhost:5432/cockpit?sslmode=require

# Unpooled connection for Prisma migrations and long-running queries
DATABASE_URL_UNPOOLED=postgresql://user:password@localhost:5432/cockpit?sslmode=require&connection_limit=1

# Connection pool size (optional, defaults to 5 for serverless)
# Serverless: 5-10 | Traditional: 20-50 | Heavy load: 50-100
DATABASE_CONNECTION_LIMIT=5

# ============================================================
# NEXTAUTH (Required)
# ============================================================
# üîê Generate: openssl rand -base64 32
#
# Fixed: V-011 (CVSS 9.1) - CRITICAL: Rotate immediately if exposed
# Impact: Session forgery, complete account takeover
#
# Requirements:
# - Minimum 32 characters (256 bits)
# - Cryptographically secure random string
# - Different value for each environment
# - Rotate every 90 days
#
NEXTAUTH_SECRET=REPLACE_WITH_OUTPUT_OF_OPENSSL_RAND_BASE64_32

# Full URL of your app (no trailing slash)
# Dev: http://localhost:3000
# Prod: https://your-domain.com
NEXTAUTH_URL=http://localhost:3000

# ============================================================
# ADMIN BOOTSTRAP (Optional - for admin password login)
# ============================================================
# üîê Generate password hash:
#   node -e "console.log(require('bcryptjs').hashSync('YourSecurePassword123!', 12))"
#
# ‚ö†Ô∏è SECURITY WARNINGS:
# - Use a password manager to generate strong passwords (min 16 chars)
# - Never use common passwords or dictionary words
# - Hash must be bcrypt with cost factor 12+
# - This is for emergency admin access only
# - Primary admin auth should use WebAuthn passkeys
#
# For local development:
ADMIN_EMAIL=admin@example.com
# ADMIN_PASSWORD_HASH=$2b$12$... (generate and set in .env.local ONLY)

# ============================================================
# WEBAUTHN (Passkeys)
# ============================================================
# Relying Party ID: domain without protocol
# Dev: "localhost" | Prod: "app.example.com"
WEBAUTHN_RP_ID=localhost

# Relying Party Origin: full URL with protocol
WEBAUTHN_ORIGIN=http://localhost:3000

# ============================================================
# REDIS (Recommended for Production)
# ============================================================
# Required for: Rate limiting, WebAuthn challenge storage, session management
# Provider: Upstash Redis (https://upstash.com)
#
# Setup:
# 1. Create account at upstash.com
# 2. Create new Redis database
# 3. Copy REST URL and token from console
#
# If not provided:
# - Development: Falls back to in-memory storage (single instance only)
# - Production: ‚ö†Ô∏è Rate limiting won't work across instances
#
UPSTASH_REDIS_REST_URL=https://your-database-name.upstash.io
UPSTASH_REDIS_REST_TOKEN=AYourTokenHereXXXXXXXXXXXXXXXX

# ============================================================
# EMAIL (Optional - for automated email sending)
# ============================================================
# Provider: Brevo (Sendinblue) - Recommended
#
# ‚ö†Ô∏è  EMAIL IS NOW OPTIONAL!
# - Admin panel shows code/magic link for manual distribution
# - CLI script (pnpm admin:generate-code) generates codes without email
# - Email only needed if you want automated sending
#
# ‚úÖ Why Brevo (if you want automated emails)?
# - 300 emails/day free (no credit card required)
# - Send to ANY email (no verification needed)
# - Better deliverability than Gmail SMTP
#
# Setup (2 minutes - skip if using manual distribution):
# 1. Sign up: https://www.brevo.com/
# 2. Get SMTP credentials: https://app.brevo.com/settings/keys/smtp
# 3. Copy the SMTP login (format: xxxxx@smtp-brevo.com)
# 4. Copy the SMTP key (starts with xsmtpsib-)
#
# Leave blank to use manual distribution (no auto-send):
SMTP_HOST=smtp-relay.brevo.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
EMAIL_FROM=noreply@cockpit-dev.com

# Production: Use noreply@cockpit-app.com or your verified domain
# Development: Use noreply@cockpit-dev.com to distinguish environments

# Old providers (deprecated):
# RESEND_API_KEY=re_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# GMAIL_USER=your.email@gmail.com
# GMAIL_APP_PASSWORD=your-16-char-app-password

# ============================================================
# ADVANCED AUTHENTICATION (Required)
# ============================================================
# üîê Generate TOTP Encryption Key:
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# Fixed: Advanced auth implementation - TOTP secrets encrypted at rest
# Impact: TOTP secrets stored in plaintext if not set
#
# Requirements:
# - Exactly 64 hexadecimal characters (32 bytes)
# - Cryptographically secure random string
# - NEVER commit to Git
# - Rotate if compromised
#
TOTP_ENCRYPTION_KEY=REPLACE_WITH_64_HEX_CHARS_FROM_CRYPTO_RANDOMBYTES

# üîê Generate JWT Secret Key:
#   node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
#
# Used for: Security action tokens ("Not me" button, account recovery)
#
# Requirements:
# - Minimum 32 characters
# - Cryptographically secure random string
# - Different from NEXTAUTH_SECRET
#
JWT_SECRET_KEY=REPLACE_WITH_OUTPUT_OF_CRYPTO_RANDOMBYTES_BASE64

# Application name (displayed in TOTP apps and emails)
NEXT_PUBLIC_APP_NAME=Cockpit

# üîê Generate Cron Secret Key (for production cron jobs):
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# Used for: Securing cron job endpoints (password expiry warnings, etc.)
#
# Requirements:
# - Minimum 32 characters
# - Cryptographically secure random string
# - Only needed in production
#
CRON_SECRET_KEY=REPLACE_WITH_64_HEX_CHARS_FROM_CRYPTO_RANDOMBYTES

# ============================================================
# PUSH NOTIFICATIONS (Optional - Phase E PWA)
# ============================================================
# üîê Generate VAPID keys:
#   npx web-push generate-vapid-keys
#
# Fixed: VAPID private key should never be committed
# Impact: Ability to send push notifications as your application
#
# Public key (safe to expose to client)
NEXT_PUBLIC_VAPID_PUBLIC_KEY=BXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# Private key (NEVER expose to client, NEVER commit to Git)
VAPID_PRIVATE_KEY=YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY

# ============================================================
# MONITORING (Optional)
# ============================================================
# Sentry for error tracking
SENTRY_DSN=https://...ingest.sentry.io/...

# PostHog for product analytics
NEXT_PUBLIC_POSTHOG_KEY=phc_your_key_here
NEXT_PUBLIC_POSTHOG_HOST=https://us.i.posthog.com

# ============================================================
# ANALYTICS (Optional - Phase E)
# ============================================================
# Hotjar - Session recording and heatmaps
# Get your ID from: https://insights.hotjar.com/sites
NEXT_PUBLIC_HOTJAR_ID=your_hotjar_id_here
NEXT_PUBLIC_HOTJAR_VERSION=6

# Mixpanel - Product analytics and events
# Get your token from: https://mixpanel.com/project/settings
NEXT_PUBLIC_MIXPANEL_TOKEN=your_mixpanel_token_here

# Enable/disable analytics globally
# Set to 'true' to enable, 'false' to disable
NEXT_PUBLIC_ANALYTICS_ENABLED=false

# ============================================================
# FEATURE FLAGS (Optional)
# ============================================================
ENABLE_PASSKEYS=true
ENABLE_MAGIC_LINKS=false

# ============================================================
# VERCEL (Auto-populated by Vercel deployment)
# ============================================================
# These are set automatically by Vercel, don't set manually
# VERCEL=1
# VERCEL_ENV=production
# VERCEL_URL=your-app.vercel.app
# VERCEL_OIDC_TOKEN=<auto-generated>

# ============================================================
# NODE ENVIRONMENT
# ============================================================
# Auto-detected by Next.js, set explicitly if needed
NODE_ENV=development
