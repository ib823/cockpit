generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model AuditEvent {
  id        String   @id
  userId    String
  type      String
  createdAt DateTime @default(now())
  meta      Json?
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type, createdAt])
}

model SecurityEvent {
  id        String   @id
  type      String
  ipAddress String?
  userId    String?
  createdAt DateTime @default(now())
  meta      Json?

  @@index([type, createdAt])
  @@index([ipAddress])
}

model Authenticator {
  id         String   @id
  userId     String
  publicKey  Bytes
  counter    Int
  transports String[]
  deviceType String
  backedUp   Boolean
  nickname   String?
  createdAt  DateTime @default(now())
  lastUsedAt DateTime @default(now())
  users      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model EmailApproval {
  email            String    @id
  tokenHash        String
  tokenExpiresAt   DateTime
  approvedByUserId String
  usedAt           DateTime?
  createdAt        DateTime  @default(now())
  codeSent         Boolean   @default(false)
}

model accounts {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  users             users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model audit_logs {
  id        String      @id
  userId    String
  action    AuditAction
  entity    String
  entityId  String
  changes   Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime    @default(now())
  users     users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([entity, entityId])
  @@index([userId])
}

model chips {
  id         String   @id
  projectId  String
  createdAt  DateTime @default(now())
  confidence Decimal  @db.Decimal(3, 2)
  evidence   String?
  type       ChipType
  value      String
  projects   projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([type])
}

model comments {
  id        String   @id
  projectId String
  userId    String
  content   String
  resolved  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime
  projects  projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId])
}

model form_items {
  id         String   @id
  projectId  String
  name       String
  type       String
  languages  String[]
  complexity String
  effort     Decimal  @db.Decimal(10, 2)
  createdAt  DateTime @default(now())
  projects   projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model holidays {
  id     String   @id
  name   String
  date   DateTime @db.Date
  region String

  @@unique([date, region])
  @@index([date])
  @@index([region])
}

model integration_items {
  id         String   @id
  projectId  String
  name       String
  type       String
  source     String
  target     String
  complexity String
  volume     String
  effort     Decimal  @db.Decimal(10, 2)
  createdAt  DateTime @default(now())
  projects   projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model magic_tokens {
  id         String    @id
  email      String
  token      String    @unique
  expiresAt  DateTime
  usedAt     DateTime?
  deviceInfo String?
  ipAddress  String?
  createdAt  DateTime  @default(now())
  type       String    @default("otp")

  @@index([email])
  @@index([token])
  @@index([type])
}

model phases {
  id               String      @id
  projectId        String
  name             String
  workingDays      Int
  color            String      @default("blue")
  order            Int
  createdAt        DateTime    @default(now())
  updatedAt        DateTime
  category         String
  dependencies     String?
  effort           Decimal     @db.Decimal(10, 2)
  startBusinessDay Int
  projects         projects    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  resources        resources[]

  @@index([order])
  @@index([projectId])
}

model projects {
  id                 String              @id
  name               String
  description        String?
  status             ProjectStatus       @default(DRAFT)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  clientName         String?
  complexity         String?
  duration           Int?
  employees          Int?
  endDate            DateTime?
  industry           String?
  integrationPosture String?
  legalEntities      Int?
  moduleCombo        String?
  ownerId            String
  rateRegion         String?
  region             String?
  revenue            Decimal?            @db.Decimal(15, 2)
  ssoMode            String?
  startDate          DateTime?
  totalCost          Decimal?            @db.Decimal(15, 2)
  totalEffort        Decimal?            @db.Decimal(10, 2)
  dashboardComments  DashboardComment[]
  dashboardExports   DashboardExport[]
  dashboardScenarios DashboardScenario[]
  dashboardSnapshots DashboardSnapshot[]
  chips              chips[]
  comments           comments[]
  form_items         form_items[]
  integration_items  integration_items[]
  phases             phases[]
  users              users               @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  resources          resources[]
  ricefw_items       ricefw_items[]
  shares             shares[]
  snapshots          snapshots[]

  @@index([createdAt])
  @@index([ownerId])
  @@index([status])
}

model push_subscriptions {
  id           String   @id
  email        String   @unique
  subscription Json
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@index([email])
}

model resources {
  id         String   @id
  projectId  String
  phaseId    String?
  name       String
  role       String
  allocation Int
  createdAt  DateTime @default(now())
  hourlyRate Decimal  @db.Decimal(10, 2)
  region     String
  phases     phases?  @relation(fields: [phaseId], references: [id])
  projects   projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([phaseId])
  @@index([projectId])
}

model ricefw_items {
  id            String   @id
  projectId     String
  type          String
  name          String
  description   String?
  complexity    String
  count         Int
  effortPerItem Decimal  @db.Decimal(10, 2)
  totalEffort   Decimal  @db.Decimal(10, 2)
  phase         String
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  projects      projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, type])
}

model sessions {
  id                String    @id
  sessionToken      String    @unique
  userId            String
  expires           DateTime
  deviceInfo        Json?
  ipAddress         String?
  lastActivity      DateTime  @default(now())
  deviceFingerprint String?
  userAgent         String?
  country           String?
  city              String?
  createdAt         DateTime  @default(now())
  revokedAt         DateTime?
  revokedReason     String?
  users             users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([lastActivity])
  @@index([deviceFingerprint])
  @@index([revokedAt])
}

model shares {
  id           String    @id
  projectId    String
  token        String    @unique
  expiresAt    DateTime?
  viewCount    Int       @default(0)
  lastViewedAt DateTime?
  createdAt    DateTime  @default(now())
  projects     projects  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([token])
}

model snapshots {
  id        String   @id
  projectId String
  data      Json
  createdAt DateTime @default(now())
  createdBy String
  label     String?
  version   Int
  projects  projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, version])
  @@index([projectId])
}

model users {
  id                    String                   @id
  email                 String                   @unique
  name                  String?
  createdAt             DateTime                 @default(now())
  emailVerified         DateTime?
  image                 String?
  role                  Role                     @default(USER)
  updatedAt             DateTime
  accessExpiresAt       DateTime                 @default(now())
  exception             Boolean                  @default(false)
  firstLoginAt          DateTime?
  lastLoginAt           DateTime?
  lastTimelineAt        DateTime?
  timelinesGenerated    Int                      @default(0)
  lastSeenAt            DateTime?
  passwordHash          String?
  passwordChangedAt     DateTime?
  passwordExpiresAt     DateTime?
  passwordHistory       String[]
  totpSecret            String?
  totpEnabledAt         DateTime?
  maxConcurrentSessions Int                      @default(1)
  accountLockedAt       DateTime?
  accountLockedReason   String?
  failedLoginAttempts   Int                      @default(0)
  lastFailedLoginAt     DateTime?
  pendingEmail          String?
  pendingEmailToken     String?
  pendingEmailExpiresAt DateTime?
  recoveryRequests      AccountRecoveryRequest[]
  AuditEvent            AuditEvent[]
  Authenticator         Authenticator[]
  dashboardComments     DashboardComment[]
  dashboardExports      DashboardExport[]
  dashboardScenarios    DashboardScenario[]
  dashboardSettings     DashboardSettings?
  dashboardSnapshots    DashboardSnapshot[]
  ganttProjects         GanttProject[]
  loginHistory          LoginHistory[]
  recoveryCodes         RecoveryCode[]
  securityActions       SecurityAction[]
  trustedDevices        TrustedDevice[]
  accounts              accounts[]
  audit_logs            audit_logs[]
  comments              comments[]
  projects              projects[]
  sessions              sessions[]

  @@index([email])
  @@index([lastSeenAt])
  @@index([accountLockedAt])
  @@index([passwordExpiresAt])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

/// Organization for multi-tenancy support
model Organization {
  id              String           @id @default(cuid())
  name            String
  settings        Json
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  rateCards       RateCard[]
  savedSelections SavedSelection[]
  scenarios       Scenario[]
  members         TeamMember[]

  @@index([name])
}

/// Team member with role-based access control
model TeamMember {
  id             String       @id @default(cuid())
  userId         String
  organizationId String
  role           UserRole     @default(VIEWER)
  createdAt      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([organizationId])
  @@index([userId])
}

/// Line of Business (12 LOBs)
model Lob {
  id                  String        @id @default(cuid())
  lobName             String        @unique
  l3Count             Int
  releaseTag          String
  navigatorSectionUrl String
  createdAt           DateTime      @default(now())
  l3ScopeItems        L3ScopeItem[]

  @@index([lobName])
}

/// L3 Scope Item (293 items from SAP Process Navigator)
model L3ScopeItem {
  id                  String              @id @default(cuid())
  lobId               String
  module              String?
  l3Code              String              @unique
  l3Name              String
  processNavigatorUrl String
  formerCode          String?
  releaseTag          String
  createdAt           DateTime            @default(now())
  complexityMetrics   ComplexityMetrics?
  integrationDetails  IntegrationDetails?
  lob                 Lob                 @relation(fields: [lobId], references: [id], onDelete: Cascade)

  @@index([lobId])
  @@index([l3Code])
  @@index([module])
}

/// Complexity metrics for each L3 item
model ComplexityMetrics {
  id                 String      @id @default(cuid())
  l3Id               String      @unique
  defaultTier        String
  coefficient        Float?
  tierRationale      String
  crossModuleTouches String?
  localizationFlag   Boolean     @default(false)
  extensionRisk      String
  createdAt          DateTime    @default(now())
  l3ScopeItem        L3ScopeItem @relation(fields: [l3Id], references: [id], onDelete: Cascade)

  @@index([defaultTier])
  @@index([extensionRisk])
}

/// Integration details for each L3 item
model IntegrationDetails {
  id                          String      @id @default(cuid())
  l3Id                        String      @unique
  integrationPackageAvailable String
  testScriptExists            Boolean     @default(true)
  createdAt                   DateTime    @default(now())
  l3ScopeItem                 L3ScopeItem @relation(fields: [l3Id], references: [id], onDelete: Cascade)
}

/// Saved L3 selection bundles for reuse
model SavedSelection {
  id             String       @id @default(cuid())
  name           String
  description    String?
  l3ItemIds      String[]
  organizationId String
  createdBy      String
  isPublic       Boolean      @default(false)
  usageCount     Int          @default(0)
  tags           String[]
  createdAt      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([createdBy])
  @@index([isPublic])
}

/// Rate card for resource costing
model RateCard {
  id             String       @id @default(cuid())
  organizationId String
  name           String
  country        String
  currency       String
  rates          Json
  effectiveFrom  DateTime
  effectiveTo    DateTime?
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, isActive])
  @@index([country])
}

/// Scenario (saved estimate with results)
model Scenario {
  id             String            @id @default(cuid())
  userId         String
  organizationId String?
  name           String
  inputs         Json
  totalMD        Float
  durationMonths Float
  pmoMD          Float
  phases         Json
  startDate      DateTime?
  resources      Json?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  organization   Organization?     @relation(fields: [organizationId], references: [id])
  versions       ScenarioVersion[]

  @@index([userId])
  @@index([organizationId])
  @@index([createdAt])
}

/// Scenario version history for audit trail
model ScenarioVersion {
  id            String   @id @default(cuid())
  scenarioId    String
  versionNumber Int
  label         String?
  snapshot      Json
  changes       Json?
  changeReason  String?
  createdBy     String
  createdAt     DateTime @default(now())
  scenario      Scenario @relation(fields: [scenarioId], references: [id], onDelete: Cascade)

  @@unique([scenarioId, versionNumber])
  @@index([scenarioId])
  @@index([createdAt])
}

/// Gantt Project - Main project container
model GanttProject {
  id           String              @id @default(cuid())
  userId       String
  name         String
  description  String?
  startDate    DateTime            @db.Date
  viewSettings Json
  budget       Json?
  orgChart     Json?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  deletedAt    DateTime?
  holidays     GanttHoliday[]
  milestones   GanttMilestone[]
  phases       GanttPhase[]
  user         users               @relation(fields: [userId], references: [id], onDelete: Cascade)
  shares       GanttProjectShare[]
  resources    GanttResource[]

  @@index([userId])
  @@index([createdAt])
  @@index([updatedAt])
  @@index([deletedAt])
}

/// Gantt Phase - Major project phases
model GanttPhase {
  id                       String                         @id @default(cuid())
  projectId                String
  name                     String
  description              String?
  color                    String
  startDate                DateTime                       @db.Date
  endDate                  DateTime                       @db.Date
  collapsed                Boolean                        @default(false)
  order                    Int                            @default(0)
  dependencies             String[]
  project                  GanttProject                   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  phaseResourceAssignments GanttPhaseResourceAssignment[]
  tasks                    GanttTask[]

  @@index([projectId])
  @@index([order])
}

/// Gantt Task - Individual tasks within phases
model GanttTask {
  id                  String                        @id @default(cuid())
  phaseId             String
  name                String
  description         String?
  startDate           DateTime                      @db.Date
  endDate             DateTime                      @db.Date
  progress            Int                           @default(0)
  assignee            String?
  order               Int                           @default(0)
  dependencies        String[]
  collapsed           Boolean                       @default(false)
  isParent            Boolean                       @default(false)
  level               Int                           @default(0)
  parentTaskId        String?
  parentTask          GanttTask?                    @relation("TaskHierarchy", fields: [parentTaskId], references: [id], onDelete: Cascade)
  childTasks          GanttTask[]                   @relation("TaskHierarchy")
  phase               GanttPhase                    @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  resourceAssignments GanttTaskResourceAssignment[]

  @@index([phaseId])
  @@index([order])
  @@index([parentTaskId])
  @@index([level])
}

/// Gantt Milestone - Key project milestones
model GanttMilestone {
  id          String       @id @default(cuid())
  projectId   String
  name        String
  description String?
  date        DateTime     @db.Date
  icon        String
  color       String
  project     GanttProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([date])
}

/// Gantt Holiday - Project holidays/non-working days
model GanttHoliday {
  id        String       @id @default(cuid())
  projectId String
  name      String
  date      DateTime     @db.Date
  region    String
  type      String
  project   GanttProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([date])
}

/// Gantt Resource - Team members and their roles
model GanttResource {
  id                String                         @id @default(cuid())
  projectId         String
  name              String
  category          String
  description       String
  designation       String
  managerResourceId String?
  email             String?
  department        String?
  location          String?
  projectRole       String?
  rateType          String?
  hourlyRate        Decimal?                       @db.Decimal(10, 2)
  dailyRate         Decimal?                       @db.Decimal(10, 2)
  currency          String?
  utilizationTarget Int?
  createdAt         DateTime                       @default(now())
  phaseAssignments  GanttPhaseResourceAssignment[]
  project           GanttProject                   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  taskAssignments   GanttTaskResourceAssignment[]

  @@index([projectId])
  @@index([category])
}

/// Task Resource Assignment - Links resources to tasks
model GanttTaskResourceAssignment {
  id                   String        @id @default(cuid())
  taskId               String
  resourceId           String
  assignmentNotes      String
  allocationPercentage Int
  assignedAt           DateTime      @default(now())
  resource             GanttResource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  task                 GanttTask     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, resourceId])
  @@index([taskId])
  @@index([resourceId])
}

/// Phase Resource Assignment - Links PM resources to phases
model GanttPhaseResourceAssignment {
  id                   String        @id @default(cuid())
  phaseId              String
  resourceId           String
  assignmentNotes      String
  allocationPercentage Int
  assignedAt           DateTime      @default(now())
  phase                GanttPhase    @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  resource             GanttResource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  @@unique([phaseId, resourceId])
  @@index([phaseId])
  @@index([resourceId])
}

/// Gantt Project Share - Share projects with view-only access
model GanttProjectShare {
  id           String       @id @default(cuid())
  projectId    String
  token        String       @unique
  expiresAt    DateTime?
  viewCount    Int          @default(0)
  lastViewedAt DateTime?
  createdAt    DateTime     @default(now())
  createdBy    String
  project      GanttProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([token])
}

/// Trusted devices for device fingerprinting
model TrustedDevice {
  id          String   @id @default(cuid())
  userId      String
  fingerprint String
  lastSeenIp  String
  lastSeenAt  DateTime @default(now())
  nickname    String?
  userAgent   String
  country     String?
  city        String?
  createdAt   DateTime @default(now())
  user        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, fingerprint])
  @@index([userId])
  @@index([fingerprint])
  @@index([lastSeenAt])
}

/// Login history with IP intelligence
model LoginHistory {
  id                String   @id @default(cuid())
  userId            String
  ipAddress         String
  country           String?
  city              String?
  region            String?
  timezone          String?
  deviceId          String?
  deviceFingerprint String?
  userAgent         String?
  success           Boolean
  failureReason     String?
  authMethod        String?
  timestamp         DateTime @default(now())
  user              users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([ipAddress])
  @@index([timestamp])
  @@index([success])
  @@index([deviceFingerprint])
}

/// Recovery codes for account recovery
model RecoveryCode {
  id        String    @id @default(cuid())
  userId    String
  codeHash  String
  usedAt    DateTime?
  usedFrom  String?
  createdAt DateTime  @default(now())
  user      users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([usedAt])
}

/// Security actions (e.g., "Not me" button responses)
model SecurityAction {
  id        String    @id @default(cuid())
  userId    String
  action    String
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  ipAddress String?
  userAgent String?
  metadata  Json?
  createdAt DateTime  @default(now())
  user      users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([expiresAt])
  @@index([usedAt])
}

/// Account recovery requests (admin-assisted)
model AccountRecoveryRequest {
  id              String    @id @default(cuid())
  userId          String
  reason          String
  status          String    @default("pending")
  submittedAt     DateTime  @default(now())
  approvedBy      String?
  approvedAt      DateTime?
  rejectedBy      String?
  rejectedAt      DateTime?
  rejectionReason String?
  notes           String?
  user            users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([submittedAt])
}

/// Email delivery tracking
model EmailLog {
  id         String    @id @default(cuid())
  to         String
  subject    String
  template   String
  status     String    @default("pending")
  provider   String?
  error      String?
  metadata   Json?
  sentAt     DateTime?
  failedAt   DateTime?
  retryCount Int       @default(0)
  createdAt  DateTime  @default(now())

  @@index([to])
  @@index([status])
  @@index([template])
  @@index([createdAt])
}

/// Dashboard Snapshot - Stores saved dashboard states for later recall
model DashboardSnapshot {
  id            String   @id @default(cuid())
  projectId     String
  userId        String
  name          String
  description   String?
  costBreakdown Json
  margins       Json
  revenue       Decimal  @db.Decimal(12, 2)
  metrics       Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  isDefault     Boolean  @default(false)
  project       projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId, userId])
  @@index([userId, createdAt])
}

/// Dashboard Scenario - For what-if analysis and scenario planning
model DashboardScenario {
  id          String   @id @default(cuid())
  projectId   String
  userId      String
  name        String
  description String?
  projectData Json
  revenue     Decimal  @db.Decimal(12, 2)
  assumptions Json?
  costDelta   Decimal? @db.Decimal(12, 2)
  marginDelta Decimal? @db.Decimal(6, 3)
  timeDelta   Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  isBaseline  Boolean  @default(false)
  project     projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId, projectId])
}

/// Dashboard Comment - Collaborative comments on dashboard elements
model DashboardComment {
  id          String             @id @default(cuid())
  projectId   String
  userId      String
  elementId   String?
  elementType String?
  content     String
  resolved    Boolean            @default(false)
  parentId    String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  parent      DashboardComment?  @relation("CommentThread", fields: [parentId], references: [id], onDelete: Cascade)
  replies     DashboardComment[] @relation("CommentThread")
  project     projects           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user        users              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId, elementId])
  @@index([userId, projectId])
  @@index([parentId])
}

/// Dashboard Settings - User-specific dashboard preferences
model DashboardSettings {
  id              String   @id @default(cuid())
  userId          String   @unique
  defaultView     String   @default("all")
  showChartTables Boolean  @default(false)
  autoRefresh     Boolean  @default(false)
  refreshInterval Int      @default(300000)
  customRateCard  Json?
  notifyOnChange  Boolean  @default(true)
  notifyOnComment Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

/// Dashboard Share - Share dashboard snapshots with others
model DashboardShare {
  id            String    @id @default(cuid())
  snapshotId    String
  sharedBy      String
  sharedWith    String?
  accessLevel   String    @default("view")
  expiresAt     DateTime?
  password      String?
  allowDownload Boolean   @default(true)
  viewCount     Int       @default(0)
  lastViewed    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([snapshotId])
  @@index([sharedBy])
  @@index([sharedWith])
}

/// Dashboard Export History - Track dashboard exports for audit purposes
model DashboardExport {
  id           String    @id @default(cuid())
  projectId    String
  userId       String
  format       String
  filename     String
  fileSize     Int?
  status       String    @default("pending")
  errorMessage String?
  storageUrl   String?
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())
  completedAt  DateTime?
  project      projects  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user         users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId, createdAt])
  @@index([status])
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  SHARE
  EXPORT
  APPROVE
  ARCHIVE
}

enum ChipType {
  COUNTRY
  EMPLOYEES
  REVENUE
  INDUSTRY
  MODULES
  TIMELINE
  INTEGRATION
  COMPLIANCE
  LEGAL_ENTITIES
  SSO
  BANKING
  EXISTING_SYSTEM
  LOCATIONS
  USERS
  DATA_VOLUME
  CURRENCIES
  LANGUAGES
}

enum ProjectStatus {
  DRAFT
  IN_REVIEW
  APPROVED
  ARCHIVED
}

enum Role {
  USER
  MANAGER
  ADMIN
}

enum UserRole {
  ADMIN
  OWNER
  EDITOR
  VIEWER
}
